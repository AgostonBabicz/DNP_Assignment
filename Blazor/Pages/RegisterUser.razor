@page "/RegisterUser"
@using Domain.DTOs
@using Blazor.Services
@using UIComponents
@inject IAuthService authService
@inject NavigationManager navMgr
<div>
    <h3>Register yourself as a new user </h3>
    <div>
        <label>Username:</label>
        <input type="text" @bind="username">
    </div>
    <div>
        <label>Password:</label>
        <input type="text" @bind="password">
    </div>
    <button @onclick="Register">Register</button>
    <h5>@message</h5>
    <Modal ShowModal="showModal">
        <p>You have successfully registered. We will redirect you to the login page</p>
        <button @onclick="@GoOn">Wonderful</button>
    </Modal>
</div>

@code {
    private bool showModal;
    private string username;
    private string password;
    private string message = "";

    private async Task Register()
    {
        try
        {
            await authService.RegisterAsync(new UserCreationDto(username, password));
            showModal = true;
        }catch(Exception e)
        {
            Console.WriteLine(e);
            message = e.Message;
        }
    }

    private void GoOn()
    {
        showModal = false;
        navMgr.NavigateTo("/Login");
    }
}